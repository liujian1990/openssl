Description: fix incorrect cookie handling for TLDs
Origin: upstream, http://curl.haxx.se/CVE-2014-3620.patch

Warning: this patch contain weird line endings, be careful when editing

Index: curl-7.37.1/lib/cookie.c
===================================================================
--- curl-7.37.1.orig/lib/cookie.c	2014-09-11 08:14:04.287233616 -0400
+++ curl-7.37.1/lib/cookie.c	2014-09-11 08:14:26.591233742 -0400
@@ -463,6 +463,7 @@
         }
         else if(Curl_raw_equal("domain", name)) {
           bool is_ip;
+          const char *dotp;
 
           /* Now, we make sure that our host is within the given domain,
              or the given domain is not valid and thus cannot be set. */
@@ -472,6 +473,11 @@
 
           is_ip = isip(domain ? domain : whatptr);
 
+          /* check for more dots */
+          dotp = strchr(whatptr, '.');
+          if(!dotp)
+            domain=":";
+
           if(!domain
              || (is_ip && !strcmp(whatptr, domain))
              || (!is_ip && tailmatch(whatptr, domain))) {
Index: curl-7.37.1/tests/data/test61
===================================================================
--- curl-7.37.1.orig/tests/data/test61	2014-06-11 13:52:30.000000000 -0400
+++ curl-7.37.1/tests/data/test61	2014-09-11 08:15:23.283234062 -0400
@@ -23,6 +23,7 @@
 Set-Cookie: test4=no; domain=nope.foo.com; path=/moo; secure
 Set-Cookie: test5=name; domain=anything.com; path=/ ; secure
 Set-Cookie: fake=fooledyou; domain=..com; path=/;
+Set-Cookie: supercookie=fooledyou; domain=.com; path=/;
 Content-Length: 4
 
 boo
